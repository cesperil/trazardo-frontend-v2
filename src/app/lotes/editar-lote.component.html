<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header">
      <h3>Editar Lote</h3>
    </div>
    <div class="card-body">
      <form (ngSubmit)="saveLote()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="lote" class="form-label">Lote</label>
            <input id="lote" class="form-control" [(ngModel)]="lote.lote" name="lote" required />
          </div>
          <div class="col-md-6 mb-3">
            <label for="tecnico" class="form-label">Técnico</label>
            <app-searchable-dropdown [(ngModel)]="tecnicoId" [options]="tecnicos" optionLabel="nombreCompleto"
              optionValue="id" placeholder="Seleccione un técnico" inputId="tecnico">
            </app-searchable-dropdown>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="explotacion" class="form-label">Explotación</label>
            <app-searchable-dropdown [(ngModel)]="explotacionId" [options]="explotaciones" optionLabel="nombre"
              optionValue="id" placeholder="Seleccione una finca" inputId="explotacion">
            </app-searchable-dropdown>
          </div>
          <div class="col-md-6 mb-3">
            <label for="anio" class="form-label">Año</label>
            <input id="anio" type="number" class="form-control" [(ngModel)]="lote.anio" name="anio" required />
          </div>
        </div>
        <!-- Series Crotales -->
        <div class="row mb-4">
          <div class="col-md-12">
            <label class="form-label d-flex justify-content-between align-items-center">
              Series de Crotales
              <button type="button" class="btn btn-sm btn-outline-primary"
                (click)="seriesCrotales.push({crotalDesde: '', crotalHasta: ''})">
                + Añadir Serie
              </button>
            </label>
            <div class="card mb-2" *ngFor="let serie of seriesCrotales; let i = index">
              <div class="card-body p-2 d-flex align-items-center gap-2">
                <div class="flex-grow-1">
                  <label [for]="'crotalDesde' + i" class="form-label mb-0 small">Crotal desde</label>
                  <input type="text" [id]="'crotalDesde' + i" class="form-control form-control-sm"
                    [(ngModel)]="serie.crotalDesde" [name]="'crotalDesde' + i" required />
                </div>
                <div class="flex-grow-1">
                  <label [for]="'crotalHasta' + i" class="form-label mb-0 small">Crotal hasta</label>
                  <input type="text" [id]="'crotalHasta' + i" class="form-control form-control-sm"
                    [(ngModel)]="serie.crotalHasta" [name]="'crotalHasta' + i" required />
                </div>
                <button *ngIf="seriesCrotales.length > 1" type="button" class="btn btn-sm btn-outline-danger mt-4"
                  (click)="seriesCrotales.splice(i, 1)" title="Eliminar Serie">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="ganadero" class="form-label">Ganadero</label>
            <app-searchable-dropdown [(ngModel)]="ganaderoId" [options]="ganaderos" optionLabel="nombreCompleto"
              optionValue="id" placeholder="Seleccione un ganadero" inputId="ganadero">
            </app-searchable-dropdown>
          </div>
          <div class="col-md-6 mb-3">
            <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
            <input type="date" id="fechaNacimiento" class="form-control" [(ngModel)]="lote.fechaNacimiento"
              name="fechaNacimiento" />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="localizacionCrotal" class="form-label">Localización Crotal</label>
            <select id="localizacionCrotal" class="form-select" [(ngModel)]="lote.localizacionCrotal"
              name="localizacionCrotal" required>
              <option *ngFor="let option of localizacionCrotalOptions" [value]="option">
                {{ option | enumDisplay: 'localizacionCrotal' }}
              </option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label for="raza" class="form-label">Raza</label>
            <select id="raza" class="form-select" [(ngModel)]="lote.raza" name="raza" required>
              <option *ngFor="let option of razaOptions" [value]="option">
                {{ option | enumDisplay: 'raza' }}
              </option>
            </select>
          </div>
        </div>
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary me-2">Guardar</button>
          <button type="button" class="btn btn-secondary"
            (click)="router.navigate(['/gestion-lotes-admin'])">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>